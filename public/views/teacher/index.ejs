<!DOCTYPE html>
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.css" integrity="sha512-6S2HWzVFxruDlZxI3sXOZZ4/eJ8AcxkQH1+JjSe/ONCEqR9L4Ysq5JdT5ipqtzU7WHalNwzwBv+iE51gNHJNqQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.js" integrity="sha512-lbwH47l/tPXJYG9AcFNoJaTMhGvYWhVM9YI43CT+uteTRRaiLCui8snIgyAN8XWgNjNhCqlAUdzZptso6OCoFQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> 
    <script src="/js/teacherPortal.js"></script> 
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        .topnav {
        background-color: #333;
        overflow: hidden;
      
        }

        /* Style the links inside the navigation bar */
        .topnav a {
        float: right;
        color: #f2f2f2;
        text-align: center;
        padding: 14px 16px;
        text-decoration: none;
        font-size: 17px;
        }

        /* Change the color of links on hover */
        .topnav a:hover {
        background-color: #ddd;
        color: black;
        }

        /* Add a color to the active/current link */
        .topnav a.active {
        background-color: #04AA6D;
        color: white;
        }
</style>
</head>
<body>
    <div class="topnav">
        <a href="/">Logout</a>
      </div>
    <div class="card mx-auto" style="width: 60rem; margin: 10rem">
        <h1 class="text-center font-light" style="color: grey" >Teacher File Sharing Portal</h1>
        <div class="card-body mb-3">
            <div class="card mx-auto" style="width: 35rem; margin: 1rem">
                <div class="card-body mb-3">
                    <h2 class="text-center">File Upload</h2>
				<form method="post" action="/upload" id="fileUploadForm" enctype="multipart/form-data">
					<label for="upload" class="form-label"></label>
					<input type="file" class="form-control" name="upload" id="upload" />
					<br>
					
					<div class="col-auto">
						<button  class="btn btn-primary mb-3"  id="fileUploadSubmit" type="submit" value="Upload">Upload</button>  
					</div>  
				</form>
                </div>    
            </div>    
        </div>
        <div class="card-body mb-3">
            <div class="card mx-auto" style="width: 35rem; margin: 1rem">
                <div class="card-body mb-3">
                    <h2 class="text-center">Send Message</h2>
                    <form id="teacherMsgForm" name="teacherMsgForm" method="post" action="/sendMsg">
                        <label for="msg" class="form-label"></label>
                        <input class="form-control" type="text" id="msg" name="msg" placeholder="Enter message for student here..." aria-label="message">
                        <br>
                        <div class="col-auto">
                            <button  class="btn btn-primary mb-3" type="submit" name="teacherMsgSubmit" id="teacherMsgSubmit">Send</button>  
                        </div>  
                    </form>
                </div>

            </div>    
        </div>

        <div class="card-body mb-3">
            <div class="card mx-auto" style="width: 35rem; margin: 1rem">
                <div class="card-body mb-3">
                    <h3>Messages Sent</h3>
                    <table id="MessagesTable" class="table table-striped w-100">
                        <tr>
                            <th>Message</th>
                            <th>Received At</th>
                        </tr>
                        <% messages.forEach(function(message){%>
                            <tr>
                                <td><%= message.message %></td>
                                <td><%= message.created_at %></td>
                            </tr>
                        <%})%>
                        
                    </table>
                    
                </div>    
            </div>    
        </div>
    </div>
    
    <script>
    window.onload = function() {
        toastr.options = {
            "closeButton": false,
            "debug": false,
            "newestOnTop": false,
            "progressBar": false,
            "positionClass": "toast-top-right",
            "preventDuplicates": false,
            "onclick": null,
            "showDuration": "500",
            "hideDuration": "1000",
            "timeOut": "5000",
            "extendedTimeOut": "1000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        }
     }
    
    function dateFormat(date) {
    var dateString = date.toString();
    var formattedDateString =dateString.substr(0, dateString.lastIndexOf(':'));
  	return formattedDateString;
}

     $(document).ready(function() {
        $('#fileUploadSubmit').click(function(e){
			console.log("entered");
			e.preventDefault();
			var form = $('#fileUploadForm')[0];
			var data = new FormData(form);
			$.ajax({ 
				type: "POST",
				enctype: 'multipart/form-data',
				url: "/upload",
				data: data,
				processData: false,
            	contentType: false,
            	cache: false,
            	timeout: 600000,
				error: function(e){
					toastr.error("Some Error occurred!")
				},
				success: function(response){
					
				   toastr.success('File uploaded successfully!');
				   $("#upload").val("");
				}
			});  
			return false;  
			})

        $('#teacherMsgSubmit').click(function(e){
            console.log("entered");
            e.preventDefault();
            var msg= $("#msg").val();
            console.log(msg);
            $.ajax({ 
                type: "POST",
                url: "/sendMsg",
                data: {msg: msg},
                error: function(e){
                    toastr.error("Some Error occurred!")
                },
                success: function(response){
                    $("#msg").val("");
                    var time = dateFormat(new Date());

                    var messageItem= '<tr><td>'+msg+'</td><td>'+time+ '</td><td>'
                    $('#MessagesTable').append(messageItem);
                   toastr.success('Message sent!');
                  
                    
                }
            });  
            return false;  
        }) 
    
     })
          
    
    </script>



</body>

